!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);class o{constructor(){window.audioContext||(window.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.audioContext=window.audioContext,this.compressor=this.audioContext.createDynamicsCompressor(),this.compressor.attack.setValueAtTime(.03,this.audioContext.currentTime),this.masterGainNode=this.audioContext.createGain(),this.masterGainNode.connect(this.compressor),this.compressor.connect(this.audioContext.destination)}play(e){this.masterGainNode.gain.setValueAtTime(1,this.audioContext.currentTime),Promise.all(this.notes.map(e=>e.getAudio(this.audioContext))).then(()=>{this.notes.sort((e,t)=>e.value-t.value).forEach((t,n)=>{const o=this.audioContext.createBufferSource(),i=this.audioContext.createGain(),s=e?n*e:0;o.buffer=t.buffer,o.connect(i),i.connect(this.masterGainNode),i.gain.setTargetAtTime(0,this.audioContext.currentTime+s,.5),o.start(this.audioContext.currentTime+s,0,3)})})}stop(){this.masterGainNode.gain.setValueAtTime(0,this.audioContext.currentTime)}}const i={chromatic:{2:[{type:"Minor second",def:[0,1]},{type:"Major second",def:[0,2]},{type:"Minor third",def:[0,3]},{type:"Major third",def:[0,4]},{type:"Fourth",def:[0,5]},{type:"Tritone",def:[0,6]},{type:"Fifth",def:[0,7]},{type:"Minor sixth",def:[0,8]},{type:"Major sixth",def:[0,9]},{type:"Minor seventh",def:[0,10]},{type:"Major seventh",def:[0,11]},{type:"Octave",def:[0,12]}],3:[{type:"Major",def:[0,4,7]},{type:"minor",def:[0,3,7]},{type:"diminished",def:[0,3,6]},{type:"Augmented",def:[0,4,8]}],4:[{type:"Dominant",def:[0,4,7,10]},{type:"Major 7",def:[0,4,7,11]},{type:"Major 6",def:[0,4,7,9]},{type:"minor 7",def:[0,3,7,10]},{type:"minor Major 7",def:[0,3,7,11]},{type:"half-diminished 7",def:[0,3,6,10]}]},diatonic:{1:[{type:"Do",def:[0]},{type:"Re",def:[2]},{type:"Mi",def:[4]},{type:"Fa",def:[5]},{type:"Sol",def:[7]},{type:"La",def:[9]},{type:"Ti",def:[11]}],3:[{type:"Major (I)",def:[0,4,7]},{type:"minor (ii)",def:[2,5,9]},{type:"minor (iii)",def:[4,7,11]},{type:"Major (IV)",def:[5,9,12]},{type:"Major (V)",def:[7,11,14]},{type:"minor (vi)",def:[9,12,16]},{type:"diminished (vii °)",def:[11,14,17]}],4:[{type:"Major 7 (I)",def:[0,4,7,11]},{type:"minor 7 (ii)",def:[2,5,9,12]},{type:"minor 7 (iii)",def:[4,7,11,14]},{type:"Major 7 (IV)",def:[5,9,12,16]},{type:"Dominant (V7)",def:[7,11,14,17]},{type:"minor 7 (vi)",def:[9,12,16,19]},{type:"half-diminished 7 (vii ø)",def:[11,14,17,21]}]}};function s(e){return e[Math.floor(Math.random()*e.length)]}const r=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],a=["C","C♯","D","D♯","E","F","F♯","G","G♯","A","A♯","B"];class d extends o{constructor(e){super(),this.value=parseInt(e),this.file=function(e){const t=Math.floor(e/12)-1;return"./sounds/"+r[e%12]+t+"-97-127.mp3"}(this.value),this.name=a[this.value%12],this.notes=[this],this.buffer}getAudio(e){return new Promise((t,n)=>{if(this.buffer)return void t(this.buffer);const o=new XMLHttpRequest;o.open("GET",this.file,!0),o.responseType="arraybuffer",o.onload=(()=>{e.decodeAudioData(o.response,e=>{this.buffer=e,t(this.buffer)})}),o.onerror=(e=>n(e)),o.send()})}}class c extends d{constructor(e,t){super(e+Math.floor(Math.random()*t))}}class h extends d{constructor(e){const t=s(i.diatonic[1]);super(e.value+t.def[0]-0),this.name=a[this.value%12]+" / "+t.type}}const u=[-12,0,0,-12];class f extends o{constructor(e,t){super();const n=t||"chromatic";this.chord=s(i[n][e])}get name(){return 2===this.notes.length?`${this.chord.type} (${this.notes[0].name} - ${this.notes[1].name})`:this.notes[0].name+" "+this.chord.type}}class l extends f{constructor(e,t,n,o){super(n);const i=e+Math.floor(Math.random()*t);this.notes=this.chord.def.map((e,t)=>{const s=o&&n>2?u[t]:0;return new d(i+e+s)})}}class p extends f{constructor(e,t,n){super(t);const o=s(this.chord.def);this.notes=this.chord.def.map(e=>e-o).map((o,i)=>{const s=n&&t>2?u[i]:0;return new d(e.value+o+s)})}}class y extends f{constructor(e){super(2);const t=new h(e);let n=new h(e);for(;n.value===t.value||Math.abs(n.value-t.value)>12;)n=new h(e);this.notes=[t,n];const o=Math.abs(t.value-n.value);this.chord=i.chromatic[2].find(e=>e.def[1]===o)}}class m extends f{constructor(e,t,n){super(t,"diatonic");const o=12*Math.round(Math.random());this.notes=this.chord.def.map((i,s)=>{const r=n&&t>2?u[s]:0;return new d(e.value+i+r-o)})}}var v=class{constructor(e,t){const n=window.onkeyup;window.onkeyup=function(o){n&&n(o),o.key===e&&t()}}};const w=57,M=15;let g,b=!0,N=1,B=0,x=!1,E=!1,C=!1;new class{constructor(e){e.playBtn.addEventListener("click",()=>this.playQuestion()),e.hintBtn.addEventListener("click",()=>this.hint()),e.referenceBtn.addEventListener("click",()=>this.playReference()),e.refNoteSelect.addEventListener("change",()=>this.changeReference()),e.answerBtn.addEventListener("click",()=>this.showAnswer()),e.note1Radio.addEventListener("click",()=>this.setNumberOfNotesToPlay(1)),e.note2Radio.addEventListener("click",()=>this.setNumberOfNotesToPlay(2)),e.note3Radio.addEventListener("click",()=>this.setNumberOfNotesToPlay(3)),e.note4Radio.addEventListener("click",()=>this.setNumberOfNotesToPlay(4)),e.pivotChk.addEventListener("click",()=>this.setPivot()),e.voicedChk.addEventListener("click",()=>this.setVoiced()),e.diatonicChk.addEventListener("click",()=>this.setDiatonic()),this.playBtn=e.playBtn,this.answerDiv=e.answerDiv,this.refNoteSelect=e.refNoteSelect,this.refNoteLabel=e.refNoteLabel,this.referenceNote=new d(this.refNoteSelect.value),new v("r",()=>this.playQuestion()),new v("a",()=>this.playReference()),new v("h",()=>this.hint()),new v(" ",()=>this.showAnswer())}showMsg(e){this.answerDiv.innerHTML=e}playReference(){this.referenceNote.play()}changeReference(){this.referenceNote=new d(this.refNoteSelect.value),this.refNoteLabel.innerText=this.referenceNote.name}playQuestion(){b?(b=!1,this.referenceNote.stop(),1===N?g=C?new h(this.referenceNote):new c(w,M):C?2===N?g=new y(this.referenceNote):N>2&&(g=new m(this.referenceNote,N,E)):g=x?new p(this.referenceNote,N,E):new l(w,M,N,E),g.play(),this.showMsg(""),this.playBtn.innerHTML="Repeat"):this.repeatLastQuestion()}repeatLastQuestion(e){g?g.play(e):this.showMsg("Play something first")}hint(){B++,this.repeatLastQuestion(.15*B),B>3&&(B=0)}showAnswer(){g?(this.repeatLastQuestion(),this.showMsg(g.name),this.reset()):this.showMsg("Play something first")}setNumberOfNotesToPlay(e){N=e,this.reset()}setPivot(){x=!x,this.reset()}setVoiced(){E=!E,this.reset()}setDiatonic(){C=!C,this.reset()}reset(){this.playBtn.innerHTML="New",B=0,b=!0}}({answerDiv:document.getElementById("answer"),playBtn:document.getElementById("playBtn"),hintBtn:document.getElementById("hintBtn"),answerBtn:document.getElementById("answerBtn"),referenceBtn:document.getElementById("referenceBtn"),refNoteSelect:document.getElementById("refNoteSelect"),refNoteLabel:document.getElementById("refNoteLabel"),note1Radio:document.getElementById("note1"),note2Radio:document.getElementById("note2"),note3Radio:document.getElementById("note3"),note4Radio:document.getElementById("note4"),pivotChk:document.getElementById("pivotChk"),voicedChk:document.getElementById("voicedChk"),diatonicChk:document.getElementById("diatonicChk")})}]);